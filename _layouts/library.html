---
layout: page
---
{% include lang.html %}

{% assign df_strftime_m = site.data.locales[lang].df.archives.strftime | default: '/ %m' %}
{% assign df_dayjs_m = site.data.locales[lang].df.archives.dayjs | default: '/ MM' %}

<div class="container mb-3">
  {% if page.brief %}
    <p class="lead mb-0">{{ page.brief }}</p>
  {% endif %}
</div>

<div id="archives" class="pl-xl-3">
  {%- comment -%}
  Build combined sortable array of entries:
    "timestamp|type|url"
  Types: anime, games, manga, books
  Use last_modified_at if present, else date.
  {%- endcomment -%}

  {% assign sortable = "" | split: "|" %}

  {% assign collection_names = "anime,games,manga,books" | split: "," %}
  {% for coll in collection_names %}
    {% if site[coll] %}
      {% for it in site[coll] %}
        {% capture sort_ts %}
          {% if it.last_modified_at %}{{ it.last_modified_at | date: "%s" }}{% else %}{{ it.date | date: "%s" }}{% endif %}
        {% endcapture %}
        {% capture entry %}{{ sort_ts }}|{{ coll }}|{{ it.url }}{% endcapture %}
        {% assign sortable = sortable | push: entry %}
      {% endfor %}
    {% endif %}
  {% endfor %}

  {% assign sortable = sortable | sort_natural | reverse %}
  {% assign last_year = nil %}

  {% for entry in sortable %}
    {% assign parts = entry | split: "|" %}
    {% assign ts = parts[0] | plus: 0 %}
    {% assign kind = parts[1] %}
    {% assign url = parts[2] %}

    {% assign item = site[kind] | where: "url", url | first %}
    {% if item == nil %}
      {% assign item = site.pages | where: "url", url | first %}
    {% endif %}
    {% if item == nil %}
      {% continue %}
    {% endif %}

    {% assign cur_year = ts | date: "%Y" %}

    {% if cur_year != last_year %}
      {% unless forloop.first %}</ul>{% endunless %}
      <time class="year lead d-block">{{ cur_year }}</time>
      {{ '<ul class="list-unstyled">' }}
      {% assign last_year = cur_year %}
    {% endif %}

    <li>
      <span class="date day" data-ts="{{ ts }}" data-df="DD">{{ ts | date: "%d" }}</span>
      <span class="date month small text-muted ms-1" data-ts="{{ ts }}" data-df="{{ df_dayjs_m }}">
        {{ ts | date: df_strftime_m }}
      </span>
      <a href="{{ item.url | relative_url }}">{{ item.title }}</a>

      <span class="badge bg-light border ms-2 text-muted" style="font-size:.72rem;">
        {{ kind | capitalize }}
      </span>
    </li>

    {% if forloop.last %}</ul>{% endif %}
  {% endfor %}
</div>